<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>esp1.fsr.cache documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">fsr</span> <span class="project-version">main</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>esp1</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fsr</span></div></div></li><li class="depth-3 branch current"><a href="esp1.fsr.cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cache</span></div></a></li><li class="depth-3 branch"><a href="esp1.fsr.compile.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compile</span></div></a></li><li class="depth-3 branch"><a href="esp1.fsr.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="esp1.fsr.ring.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ring</span></div></a></li><li class="depth-3"><a href="esp1.fsr.runtime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>runtime</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="esp1.fsr.cache.html#var-cache-get"><div class="inner"><span>cache-get</span></div></a></li><li class="depth-1"><a href="esp1.fsr.cache.html#var-clear.21"><div class="inner"><span>clear!</span></div></a></li><li class="depth-1"><a href="esp1.fsr.cache.html#var-configure.21"><div class="inner"><span>configure!</span></div></a></li><li class="depth-1"><a href="esp1.fsr.cache.html#var-debug-info"><div class="inner"><span>debug-info</span></div></a></li><li class="depth-1"><a href="esp1.fsr.cache.html#var-get"><div class="inner"><span>get</span></div></a></li><li class="depth-1"><a href="esp1.fsr.cache.html#var-get-metrics"><div class="inner"><span>get-metrics</span></div></a></li><li class="depth-1"><a href="esp1.fsr.cache.html#var-invalidate.21"><div class="inner"><span>invalidate!</span></div></a></li><li class="depth-1"><a href="esp1.fsr.cache.html#var-put.21"><div class="inner"><span>put!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">esp1.fsr.cache</h1><div class="doc"><div class="markdown"><p>Route caching with LRU eviction for filesystem router performance.</p>
<p>Provides thread-safe caching of route resolutions to avoid repeated filesystem operations. Uses Clojure atoms for lock-free concurrent access.</p>
<h2><a href="#performance" id="performance"></a>Performance</h2>
<table>
<thead>
<tr><th> Operation </th><th> Time     </th><th> Notes                        </th></tr>
</thead>
<tbody>
<tr><td> Cache hit </td><td> &lt; 0.1ms  </td><td> 50-100x faster than miss     </td></tr>
<tr><td> Cache miss</td><td> 5-10ms   </td><td> Full filesystem resolution   </td></tr>
<tr><td> Memory    </td><td> ~1KB     </td><td> Per cached route             </td></tr>
</tbody>
</table>
<h2><a href="#dev-vs-production" id="dev-vs-production"></a>Dev vs Production</h2>
<p>Cache clearing is controlled by the Ring middleware (<code>esp1.fsr.ring</code>): - <strong>Development</strong>: Cache cleared each request when <code>tools.namespace</code> is present - <strong>Production</strong>: Cache persists for application lifetime</p>
<h2><a href="#usage" id="usage"></a>Usage</h2>
<pre><code class="language-clojure">(require '[esp1.fsr.cache :as cache])

(cache/put! "/api/users/123" "/var/www" "/var/www/api/users/&lt;id&gt;.clj" {"id" "123"})
(cache/get "/api/users/123" "/var/www")
(cache/clear!)
(cache/invalidate! #"/api/.*")
(cache/get-metrics)
</code></pre>
<h2><a href="#configuration" id="configuration"></a>Configuration</h2>
<p>Default: 1000 max entries with LRU eviction. Use <code>configure!</code> to adjust.</p>
</div></div><div class="public anchor" id="var-cache-get"><h3>cache-get</h3><div class="usage"><code>(cache-get uri root-path)</code></div><div class="doc"><div class="markdown"><p>Retrieve entry from cache, updating access time for LRU. Returns cache entry or nil if not found or cache disabled.</p>
</div></div><div class="src-link"><a href="https://github.com/esp1/fsr/blob/main/src/esp1/fsr/cache.clj#L103">view source</a></div></div><div class="public anchor" id="var-clear.21"><h3>clear!</h3><div class="usage"><code>(clear!)</code></div><div class="doc"><div class="markdown"><p>Clear all entries from cache. Returns the number of entries that were cleared.</p>
</div></div><div class="src-link"><a href="https://github.com/esp1/fsr/blob/main/src/esp1/fsr/cache.clj#L187">view source</a></div></div><div class="public anchor" id="var-configure.21"><h3>configure!</h3><div class="usage"><code>(configure! config-map)</code></div><div class="doc"><div class="markdown"><p>Update cache configuration at runtime. Accepts map with keys: :max-entries, :enabled?, :eviction-policy. Returns the updated configuration.</p>
</div></div><div class="src-link"><a href="https://github.com/esp1/fsr/blob/main/src/esp1/fsr/cache.clj#L221">view source</a></div></div><div class="public anchor" id="var-debug-info"><h3>debug-info</h3><div class="usage"><code>(debug-info)</code></div><div class="doc"><div class="markdown"><p>Get detailed cache state for debugging (development only). Returns map with :config, :metrics, :sample-keys, and :stats.</p>
</div></div><div class="src-link"><a href="https://github.com/esp1/fsr/blob/main/src/esp1/fsr/cache.clj#L246">view source</a></div></div><div class="public anchor" id="var-get"><h3>get</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Alias for cache-get. Retrieve entry from cache.</p>
</div></div><div class="src-link"><a href="https://github.com/esp1/fsr/blob/main/src/esp1/fsr/cache.clj#L261">view source</a></div></div><div class="public anchor" id="var-get-metrics"><h3>get-metrics</h3><div class="usage"><code>(get-metrics)</code></div><div class="doc"><div class="markdown"><p>Get current cache performance metrics. Returns map with :hits, :misses, :evictions, :current-size, and :hit-rate.</p>
</div></div><div class="src-link"><a href="https://github.com/esp1/fsr/blob/main/src/esp1/fsr/cache.clj#L234">view source</a></div></div><div class="public anchor" id="var-invalidate.21"><h3>invalidate!</h3><div class="usage"><code>(invalidate! pattern)</code></div><div class="doc"><div class="markdown"><p>Invalidate cache entries matching regex pattern. Pattern is matched against the full cache key (uri|root-path). Returns the number of entries invalidated.</p>
</div></div><div class="src-link"><a href="https://github.com/esp1/fsr/blob/main/src/esp1/fsr/cache.clj#L197">view source</a></div></div><div class="public anchor" id="var-put.21"><h3>put!</h3><div class="usage"><code>(put! uri root-path resolved-path params)</code></div><div class="doc"><div class="markdown"><p>Add entry to cache with LRU eviction if needed. Updates existing entry if cache key already exists. Respects :enabled? config flag.</p>
</div></div><div class="src-link"><a href="https://github.com/esp1/fsr/blob/main/src/esp1/fsr/cache.clj#L148">view source</a></div></div></div></body></html>